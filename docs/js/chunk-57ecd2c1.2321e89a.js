(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-57ecd2c1"],{"025e":function(t,e){function a(t){this._comparator=t||a.DEFAULT_COMPARATOR,this._elements=[]}t.exports=a,a.DEFAULT_COMPARATOR=function(t,e){return"number"===typeof t&&"number"===typeof e?t-e:(t=t.toString(),e=e.toString(),t==e?0:t>e?1:-1)},a.prototype.isEmpty=function(){return 0===this.size()},a.prototype.peek=function(){if(this.isEmpty())throw new Error("PriorityQueue is empty");return this._elements[0]},a.prototype.deq=function(){var t=this.peek(),e=this._elements.pop(),a=this.size();if(0===a)return t;this._elements[0]=e;var r=0;while(r<a){var n=r,i=2*r+1,s=2*r+2;if(i<a&&this._compare(i,n)>=0&&(n=i),s<a&&this._compare(s,n)>=0&&(n=s),n===r)break;this._swap(n,r),r=n}return t},a.prototype.enq=function(t){var e=this._elements.push(t),a=e-1;while(a>0){var r=Math.floor((a-1)/2);if(this._compare(a,r)<=0)break;this._swap(r,a),a=r}return e},a.prototype.size=function(){return this._elements.length},a.prototype.forEach=function(t){return this._elements.forEach(t)},a.prototype._compare=function(t,e){return this._comparator(this._elements[t],this._elements[e])},a.prototype._swap=function(t,e){var a=this._elements[t];this._elements[t]=this._elements[e],this._elements[e]=a}},"469a":function(t){t.exports=JSON.parse('[{"from":"乐园大门","to":"重庆之眼"},{"from":"乐园大门","to":"道路标记1"},{"from":"道路标记1","to":"道路标记2"},{"from":"道路标记2","to":"欢乐对对碰"},{"from":"道路标记2","to":"道路标记3"},{"from":"道路标记3","to":"矿山车"},{"from":"矿山车","to":"一号桥"},{"from":"道路标记3","to":"道路标记4"},{"from":"一号桥","to":"天旋地转"},{"from":"天旋地转","to":"道路标记5"},{"from":"道路标记5","to":"XD动感影院"},{"from":"XD动感影院","to":"翼飞冲天"},{"from":"翼飞冲天","to":"惊魂实验室"},{"from":"惊魂实验室","to":"天地双雄"},{"from":"天地双雄","to":"道路标记8"},{"from":"道路标记8","to":"高空飞翔"},{"from":"高空飞翔","to":"情景剧场"},{"from":"高空飞翔","to":"霸王龙大草帽"},{"from":"情景剧场","to":"霸王龙大草帽"},{"from":"惊魂实验室","to":"道路标记6"},{"from":"道路标记4","to":"激流勇进"},{"from":"激流勇进","to":"大摆锤"},{"from":"道路标记6","to":"大摆锤"},{"from":"大摆锤","to":"道路标记7"},{"from":"道路标记7","to":"风行者"},{"from":"风行者","to":"道路标记9"},{"from":"道路标记9","to":"霸王龙大草帽"},{"from":"道路标记9","to":"道路标记10"},{"from":"惊魂实验室","to":"道路标记9"}]')},"4bb4":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"root-container"},[a("div",{staticClass:"control-layer"},[null!==t.currentPath?a("div",{staticClass:"top-right-control-bar"},[a("sui-card",[a("sui-card-header",[t._v("路线规划")]),a("sui-card-content",[a("sui-step-group",{attrs:{vertical:"",fluid:""}},t._l(t.currentPath,(function(e){return a("sui-step",{key:e,attrs:{active:"",icon:t.getPathIcon(e),description:t.getPathDescription(e,Math.round(t.currentDistanceMap.get(e))),title:e}})})),1)],1)],1)],1):t._e(),a("div",{staticClass:"top-left-control-bar"},[a("sui-search",{attrs:{source:t.source},on:{select:t.handleSearch},scopedSlots:t._u([{key:"input",fn:function(e){var r=e.props,n=e.handlers;return[a("sui-input",t._g(t._b({staticClass:"search-input",attrs:{placeholder:"搜索您要前往的地点","icon-position":"left",icon:"search"}},"sui-input",r,!1),n))]}}])}),null!==t.currentPosition?a("sui-card",{staticClass:"current-position"},[a("sui-card-content",[t._v("当前位置: "+t._s(t.markers[t.currentPosition]["label"]))])],1):t._e(),null!==t.currentBest?a("sui-card",{staticClass:"current-best"},[a("sui-card-content",[t._v(" 当前最优目的地: "+t._s(t.currentBest.label)+" "),a("sui-card-content",{attrs:{extra:""}},[a("p",[a("sui-icon",{attrs:{name:"paper plane"}}),t._v("预计步行时间: "+t._s(t.currentBest.distance)+" 分钟 ")],1),a("p",[a("sui-icon",{attrs:{name:"clock"}}),t._v("预计等待时间: "+t._s(t.currentBest.time)+" 分钟 ")],1)])],1)],1):t._e(),null!==t.currentLabel?a("sui-card",{staticClass:"detail"},[a("sui-image",{attrs:{src:t.currentLabel.img}}),a("sui-card-content",[a("sui-card-header",[t._v(t._s(t.currentLabel.label))]),a("sui-card-meta",{staticClass:"vote"},[t._v(" 观景指数: "),a("sui-rating",{attrs:{rating:t.currentLabel.scenery,"max-rating":5,disabled:""}}),t._v(" 欢乐指数: "),a("sui-rating",{attrs:{rating:t.currentLabel.fun,"max-rating":5,disabled:""}})],1),a("sui-card-description",[t._v(t._s(t.currentLabel.description))])],1),a("sui-card-content",{attrs:{extra:""}},[a("div",{staticClass:"wait-info"},[a("div",[a("sui-icon",{attrs:{name:"user"}}),a("span",[t._v("当前排队人数: "+t._s(t.waitNum(t.currentLabel.label))+"人")])],1),a("div",[a("sui-icon",{attrs:{name:"clock"}}),t._v(" 预计等待时间: "+t._s(t.waitTime(t.currentLabel.label))+"分钟 ")],1)])])],1):t._e()],1)]),a("v-stage",{ref:"stage",staticClass:"stage-container",attrs:{config:t.stageConfig},on:{wheel:t.onWheelScroll,click:t.onStageClick}},[a("v-layer",[a("v-rect",{attrs:{config:{x:0,y:0,width:t.global.width,height:t.global.height,fill:"#BAD588"}}})],1),a("v-layer",[a("v-image",{ref:"mapObj",attrs:{config:t.mapConfig},on:{dragend:t.handleMapDrag}})],1),a("v-layer",[t._l(t.markers,(function(t){return a("v-image",{key:"marker-"+t.label,attrs:{config:t}})})),t._l(t.markers,(function(t){return a("v-text",{key:"text-"+t.label,attrs:{config:{x:t.x,y:t.y,text:""+t.label,fontSize:13,fontFamily:"Ubuntu Mono",fill:"rgba(0,0,0,0)"}}})}))],2),a("v-layer",[t._l(t.paths,(function(t){return a("v-line",{key:"path-"+t.label,attrs:{config:t}})})),t._l(t.paths,(function(t){return a("v-text",{key:"path-distance-"+t.label,attrs:{config:{x:t.mx,y:t.my,text:""+t.distance,fontSize:13,fontFamily:"Ubuntu Mono"}}})}))],2),a("v-layer",t._l(t.labels,(function(e){return a("v-rect",{key:e.label,attrs:{config:e},on:{click:function(a){return t.handleLabelClick(e)}}})})),1),a("v-layer",[a("v-image",{ref:"positionObj",attrs:{config:t.positionConfig},on:{dragend:t.onPositionDragEnd}})],1)],1)],1)},n=[],i=a("d0af"),s=(a("a4d3"),a("e01a"),a("d3b7"),a("d28b"),a("3ca3"),a("ddb0"),a("dde1"));function o(t,e){var a;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(a=Object(s["a"])(t))||e&&t&&"number"===typeof t.length){a&&(t=a);var r=0,n=function(){};return{s:n,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){a=t[Symbol.iterator]()},n:function(){var t=a.next();return o=t.done,t},e:function(t){l=!0,i=t},f:function(){try{o||null==a["return"]||a["return"]()}finally{if(l)throw i}}}}a("4ec9"),a("b6802"),a("99af"),a("d81d");var l=a("6d75"),c=a("5506"),u=a("469a"),h=a("a221"),f=a("025e"),m=a.n(f),p={name:"Map",data:function(){return{global:{width:1920,height:960},stageConfig:{width:1920,height:960},mapConfig:{image:null,x:0,y:0,width:0,height:0,draggable:!0},mapImageObj:null,markerImageObj:null,scale:{factor:1.2,minimum:.5,maximum:2.5},markers:[],labels:[],paths:[],edges:new Map,markerConfig:{size:32,offset:16},searchInput:"",currentBest:null,currentLabel:null,currentPosition:null,currentDistance:null,currentDistanceMap:null,currentPath:null,targetLabel:null,positionConfig:{image:null,width:36,height:36,offsetX:18,offsetY:18,draggable:!0},source:this.generateSource()}},mounted:function(){var t=this;this.$nextTick((function(){t.loadAssets(),setTimeout((function(){t.setup()}),500)}))},methods:{setup:function(){if(this.loadLabels(),this.loadMarkers(),this.loadPaths(),null!=this.currentPosition){var t=this.$refs.positionObj.getNode(),e=this.markers[this.currentPosition];t.x(e.x),t.y(e.y)}this.currentPosition=0,this.findBest(),this.$refs.stage.getStage().batchDraw()},calculateDistance:function(t,e,a,r){return Math.sqrt((t-a)*(t-a)+(e-r)*(e-r))},loadPaths:function(){this.edges={},this.paths=[];var t,e=o(u);try{for(e.s();!(t=e.n()).done;){var a=t.value,r=a["from"],n=a["to"],i=this.findMarkerByLabel(r),s=this.findMarkerByLabel(n),l=this.calculateDistance(i.x,i.y,s.x,s.y);r in this.edges?this.edges[r].push({vertex:n,distance:l}):this.edges[r]=[{vertex:n,distance:l}],n in this.edges?this.edges[n].push({vertex:r,distance:l}):this.edges[n]=[{vertex:r,distance:l}];var c={points:[i.x,i.y,s.x,s.y],stroke:"red",strokeWidth:10,lineCap:"round",lineJoin:"round",dash:[29,20,.001,20],distance:l.toFixed(1),label:"".concat(a.from,"-").concat(a.to),mx:(i.x+s.x)/2,my:(i.y+s.y)/2,from:a["from"],to:a["to"]};null!=this.currentPath&&-1!==this.currentPath.indexOf(a["from"])&&-1!==this.currentPath.indexOf(a["to"])&&this.paths.push(c)}}catch(h){e.e(h)}finally{e.f()}},findMarkerByLabel:function(t){var e,a=o(this.markers);try{for(a.s();!(e=a.n()).done;){var r=e.value;if(r.label===t)return r}}catch(n){a.e(n)}finally{a.f()}return null},loadMarkers:function(){this.markers=[];var t,e=o(l);try{for(e.s();!(t=e.n()).done;){var a=t.value;this.generateMarker(a)}}catch(r){e.e(r)}finally{e.f()}this.positionConfig.x=this.markers[0].x,this.positionConfig.y=this.markers[0].y},loadLabels:function(){this.$set(this,"labels",[]);var t,e=o(c);try{for(e.s();!(t=e.n()).done;){var a=t.value,r=this.denormalizeCoord({x:a.x,y:a.y});this.labels.push(Object.assign({},a,r,{fill:"rgba(255,255,255,0.00)",draggable:!1}))}}catch(n){e.e(n)}finally{e.f()}this.$refs.stage.getStage().batchDraw()},loadAssets:function(){var t=this,e=this.$refs.mapObj.getNode();this.mapImageObj=new Image,this.mapImageObj.onload=function(){t.mapConfig.image=t.mapImageObj,t.mapConfig.x=t.global.width/2,t.mapConfig.y=t.global.height/2,t.mapConfig.width=t.mapImageObj.naturalWidth/4,t.mapConfig.height=t.mapImageObj.naturalHeight/4,e.offsetX(t.mapConfig.width/2),e.offsetY(t.mapConfig.height/2)},this.mapImageObj.src="/assets/map2.webp",this.markerImageObj=new Image,this.markerImageObj.src="/assets/marker.png";var a=new Image;a.src="/assets/pos.png",a.onload=function(){t.positionConfig.image=a}},relativePosition:function(){var t=this.$refs.stage.getStage(),e=t.getAbsoluteTransform().copy();e.invert();var a=t.getPointerPosition();return e.point(a)},onWheelScroll:function(t){var e=this.$refs.stage.getStage(),a=e.scaleX(),r=e.getPointerPosition(),n={x:(r.x-e.x())/a,y:(r.y-e.y())/a},i=t.evt.deltaY<0?a*this.scale.factor:a/this.scale.factor;if(!(i>=this.scale.maximum||i<=this.scale.minimum)){e.scale({x:i,y:i});var s={x:r.x-n.x*i,y:r.y-n.y*i};e.position(s),e.batchDraw()}},onStageClick:function(t){t.evt.preventDefault()},generateMarker:function(t){var e=this.denormalizeCoord({x:t.x,y:t.y});this.markers.push({x:e.x,y:e.y,width:this.markerConfig.size,height:this.markerConfig.size,label:t.label,offsetX:this.markerConfig.size/2,offsetY:this.markerConfig.size/2,type:t.type})},handleMapDrag:function(){var t=this.$refs.stage.getStage();this.setup(),t.batchDraw()},normalizeCoord:function(t){var e=this.$refs.mapObj.getNode();return{x:(t.x-e.x())/e.scaleX(),y:(t.y-e.y())/e.scaleY()}},denormalizeCoord:function(t){var e=this.$refs.mapObj.getNode();return{x:(t.x+e.x())*e.scaleX(),y:(t.y+e.y())*e.scaleY()}},handleLabelClick:function(t){if(this.currentLabel===t)this.currentLabel=null;else{this.currentLabel=t,this.currentLabel.img="/assets/".concat(t.label,".jpg");var e=this.findShortestPath();this.currentDistance=e.distance,this.currentDistanceMap=e.distanceMap,this.currentPath=e.path,this.loadPaths()}},waitNum:function(t){return Object(h["b"])(t)},waitTime:function(t){return Object(h["c"])(t)},onPositionDragEnd:function(){for(var t=this.$refs.positionObj.getNode(),e=t.x(),a=t.y(),r=null,n=1061109567,i=0;i<this.markers.length;i++){var s=this.markers[i],o=this.calculateDistance(e,a,s.x,s.y);n>o&&(n=o,r=i)}var l=this.markers[r];t.x(l.x),t.y(l.y),this.currentPosition=r,this.findBest()},findBest:function(){var t,e=this.findShortestPath(),a=e.distanceMap,r=1061109567,n=null,s=o(a);try{for(s.s();!(t=s.n()).done;){var l=Object(i["a"])(t.value,2),c=l[0],u=l[1];if("游乐设施"===this.findMarkerByLabel(c).type&&c!==this.markers[this.currentPosition].label){var h=.7*this.estimateTime(u)+.3*this.waitTime(c);h<r&&(r=h,n=c)}}}catch(f){s.e(f)}finally{s.f()}this.currentBest={label:n,distance:this.estimateTime(a.get(n)),time:this.waitTime(n)}},findShortestPath:function(){var t,e=this.markers[this.currentPosition].label;t=null===this.currentLabel?"重庆之眼":this.currentLabel.label;var a=new Map,r=new Map,n=new Map,i=function(t){return function(e,a){return t.has(e)||t.set(e,a),t.get(e)}};a.set(e,0);var s=new m.a((function(t,e){return t.distance-e.distance}));s.enq({label:e,distance:0});while(!s.isEmpty()){var l=s.deq();if(!0!==i(n)(l.label,!1)){n.set(l.label,!0);var c,u=o(this.edges[l.label]);try{for(u.s();!(c=u.n()).done;){var h=c.value,f=h.vertex,p=h.distance;i(a)(f,4144959)>i(a)(l.label,4144959)+p&&(a.set(f,a.get(l.label)+p),r.set(f,l.label),s.enq({label:f,distance:a[f]}))}}catch(b){u.e(b)}finally{u.f()}}}var d=function(t){for(var e=[],a=t.length-1;a>=0;a--)e.push(t[a]);return e},y=r.get(t),g=[t];while(r.has(y))g.push(y),y=r.get(y);return g.push(e),{distance:a.get(t),distanceMap:a,path:d(g)}},getPathDescription:function(t,e){return 0===e?"当前位置":"预计步行时间: ".concat(this.estimateTime(e)," 分钟")},getPathIcon:function(t){var e=this.findMarkerByLabel(t);return"道路标记"===e.type?"road":"gamepad"},estimateTime:function(t){return Math.round(t/55.4)},generateSource:function(){return c.map((function(t){return{title:t["label"]}}))},handleSearch:function(t){var e,a=o(c);try{for(a.s();!(e=a.n()).done;){var r=e.value;if(r["label"]===t["title"])return void this.handleLabelClick(r)}}catch(n){a.e(n)}finally{a.f()}}}},d=p,y=(a("811b"),a("2877")),g=Object(y["a"])(d,r,n,!1,null,null,null);e["default"]=g.exports},"4ec9":function(t,e,a){"use strict";var r=a("6d61"),n=a("6566");t.exports=r("Map",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),n)},"6d75":function(t){t.exports=JSON.parse('[{"x":-187,"y":238,"label":"乐园大门","type":"标记点"},{"x":-167,"y":157,"label":"重庆之眼","type":"游乐设施"},{"x":55,"y":105,"label":"欢乐对对碰","type":"游乐设施"},{"x":-68,"y":182,"label":"道路标记1","type":"道路标记"},{"x":20,"y":78,"label":"道路标记2","type":"道路标记"},{"x":2,"y":-13,"label":"矿山车","type":"游乐设施"},{"x":88,"y":42,"label":"道路标记3","type":"道路标记"},{"x":-73,"y":-76,"label":"一号桥","type":"道路标记"},{"x":154,"y":-45,"label":"道路标记4","type":"道路标记"},{"x":-36,"y":-116,"label":"天旋地转","type":"游乐设施"},{"x":171,"y":-90,"label":"激流勇进","type":"游乐设施"},{"x":-11,"y":-159,"label":"道路标记5","type":"道路标记"},{"x":197,"y":-142,"label":"大摆锤","type":"游乐设施"},{"x":20,"y":-202,"label":"XD动感影院","type":"游乐设施"},{"x":133,"y":-199,"label":"道路标记6","type":"道路标记"},{"x":82,"y":-270,"label":"惊魂实验室","type":"游乐设施"},{"x":39,"y":-238,"label":"翼飞冲天","type":"游乐设施"},{"x":308,"y":-203,"label":"道路标记7","type":"道路标记"},{"x":81,"y":-344,"label":"天地双雄","type":"游乐设施"},{"x":156,"y":-395,"label":"高空飞翔","type":"游乐设施"},{"x":117,"y":-459,"label":"情景剧场","type":"游乐设施"},{"x":98,"y":-372,"label":"道路标记8","type":"道路标记"},{"x":297,"y":-395,"label":"霸王龙大草帽","type":"游乐设施"},{"x":371,"y":-328,"label":"道路标记9","type":"道路标记"},{"x":369,"y":-248,"label":"风行者","type":"游乐设施"},{"x":253,"y":-309,"label":"道路标记10","type":"道路标记"}]')},"811b":function(t,e,a){"use strict";a("dee9")},dee9:function(t,e,a){}}]);
//# sourceMappingURL=chunk-57ecd2c1.2321e89a.js.map