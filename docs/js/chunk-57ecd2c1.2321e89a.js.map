{"version":3,"sources":["webpack:///./node_modules/priorityqueuejs/index.js","webpack:///./src/views/Map.vue?e8f3","webpack:///./node_modules/@vue/babel-preset-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js","webpack:///src/views/Map.vue","webpack:///./src/views/Map.vue?44c8","webpack:///./src/views/Map.vue","webpack:///./node_modules/core-js/modules/es.map.js","webpack:///./src/views/Map.vue?406d"],"names":["PriorityQueue","comparator","this","_comparator","DEFAULT_COMPARATOR","_elements","module","exports","a","b","toString","prototype","isEmpty","size","peek","Error","deq","first","last","pop","current","largest","left","right","_compare","_swap","enq","element","push","parent","Math","floor","length","forEach","fn","aux","render","_vm","_h","$createElement","_c","_self","staticClass","currentPath","_v","attrs","_l","path","key","getPathIcon","getPathDescription","round","currentDistanceMap","get","_e","source","on","handleSearch","scopedSlots","_u","ref","props","handlers","_g","_b","currentPosition","_s","markers","currentBest","label","distance","time","currentLabel","img","scenery","fun","description","waitNum","waitTime","stageConfig","onWheelScroll","onStageClick","x","y","width","global","height","fill","mapConfig","handleMapDrag","item","text","fontSize","fontFamily","mx","my","$event","handleLabelClick","positionConfig","onPositionDragEnd","staticRenderFns","_createForOfIteratorHelper","o","allowArrayLike","it","Symbol","iterator","Array","isArray","unsupportedIterableToArray","i","F","s","n","done","value","e","f","TypeError","err","normalCompletion","didErr","step","next","_e2","name","data","image","draggable","mapImageObj","markerImageObj","scale","factor","minimum","maximum","labels","paths","edges","Map","markerConfig","offset","searchInput","currentDistance","targetLabel","offsetX","offsetY","generateSource","mounted","$nextTick","setTimeout","methods","setup","loadLabels","loadMarkers","loadPaths","obj","marker","findBest","$refs","stage","getStage","batchDraw","calculateDistance","sqrt","x1","x2","y1","y2","vertex","v","u","findMarkerByLabel","$set","loadAssets","Image","onload","map","src","positionImage","relativePosition","transform","invert","point","pos","pointer","oldScale","newScale","mousePointTo","position","newPos","evt","preventDefault","generateMarker","coord","type","normalizeCoord","scaleX","scaleY","denormalizeCoord","r","distanceMap","md","di","mm","mei","estimateTime","findShortestPath","target","d","set","heap","getOrPut","vis","p","has","t","rp","reverse","title","component","collection","collectionStrong","init","arguments","undefined"],"mappings":"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","file":"js/chunk-57ecd2c1.2321e89a.js","sourcesContent":["/**\n * Expose `PriorityQueue`.\n */\nmodule.exports = PriorityQueue;\n\n/**\n * Initializes a new empty `PriorityQueue` with the given `comparator(a, b)`\n * function, uses `.DEFAULT_COMPARATOR()` when no function is provided.\n *\n * The comparator function must return a positive number when `a > b`, 0 when\n * `a == b` and a negative number when `a < b`.\n *\n * @param {Function}\n * @return {PriorityQueue}\n * @api public\n */\nfunction PriorityQueue(comparator) {\n  this._comparator = comparator || PriorityQueue.DEFAULT_COMPARATOR;\n  this._elements = [];\n}\n\n/**\n * Compares `a` and `b`, when `a > b` it returns a positive number, when\n * it returns 0 and when `a < b` it returns a negative number.\n *\n * @param {String|Number} a\n * @param {String|Number} b\n * @return {Number}\n * @api public\n */\nPriorityQueue.DEFAULT_COMPARATOR = function(a, b) {\n  if (typeof a === 'number' && typeof b === 'number') {\n    return a - b;\n  } else {\n    a = a.toString();\n    b = b.toString();\n\n    if (a == b) return 0;\n\n    return (a > b) ? 1 : -1;\n  }\n};\n\n/**\n * Returns whether the priority queue is empty or not.\n *\n * @return {Boolean}\n * @api public\n */\nPriorityQueue.prototype.isEmpty = function() {\n  return this.size() === 0;\n};\n\n/**\n * Peeks at the top element of the priority queue.\n *\n * @return {Object}\n * @throws {Error} when the queue is empty.\n * @api public\n */\nPriorityQueue.prototype.peek = function() {\n  if (this.isEmpty()) throw new Error('PriorityQueue is empty');\n\n  return this._elements[0];\n};\n\n/**\n * Dequeues the top element of the priority queue.\n *\n * @return {Object}\n * @throws {Error} when the queue is empty.\n * @api public\n */\nPriorityQueue.prototype.deq = function() {\n  var first = this.peek();\n  var last = this._elements.pop();\n  var size = this.size();\n\n  if (size === 0) return first;\n\n  this._elements[0] = last;\n  var current = 0;\n\n  while (current < size) {\n    var largest = current;\n    var left = (2 * current) + 1;\n    var right = (2 * current) + 2;\n\n    if (left < size && this._compare(left, largest) >= 0) {\n      largest = left;\n    }\n\n    if (right < size && this._compare(right, largest) >= 0) {\n      largest = right;\n    }\n\n    if (largest === current) break;\n\n    this._swap(largest, current);\n    current = largest;\n  }\n\n  return first;\n};\n\n/**\n * Enqueues the `element` at the priority queue and returns its new size.\n *\n * @param {Object} element\n * @return {Number}\n * @api public\n */\nPriorityQueue.prototype.enq = function(element) {\n  var size = this._elements.push(element);\n  var current = size - 1;\n\n  while (current > 0) {\n    var parent = Math.floor((current - 1) / 2);\n\n    if (this._compare(current, parent) <= 0) break;\n\n    this._swap(parent, current);\n    current = parent;\n  }\n\n  return size;\n};\n\n/**\n * Returns the size of the priority queue.\n *\n * @return {Number}\n * @api public\n */\nPriorityQueue.prototype.size = function() {\n  return this._elements.length;\n};\n\n/**\n *  Iterates over queue elements\n *\n *  @param {Function} fn\n */\nPriorityQueue.prototype.forEach = function(fn) {\n  return this._elements.forEach(fn);\n};\n\n/**\n * Compares the values at position `a` and `b` in the priority queue using its\n * comparator function.\n *\n * @param {Number} a\n * @param {Number} b\n * @return {Number}\n * @api private\n */\nPriorityQueue.prototype._compare = function(a, b) {\n  return this._comparator(this._elements[a], this._elements[b]);\n};\n\n/**\n * Swaps the values at position `a` and `b` in the priority queue.\n *\n * @param {Number} a\n * @param {Number} b\n * @api private\n */\nPriorityQueue.prototype._swap = function(a, b) {\n  var aux = this._elements[a];\n  this._elements[a] = this._elements[b];\n  this._elements[b] = aux;\n};\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"root-container\"},[_c('div',{staticClass:\"control-layer\"},[(_vm.currentPath !== null)?_c('div',{staticClass:\"top-right-control-bar\"},[_c('sui-card',[_c('sui-card-header',[_vm._v(\"路线规划\")]),_c('sui-card-content',[_c('sui-step-group',{attrs:{\"vertical\":\"\",\"fluid\":\"\"}},_vm._l((_vm.currentPath),function(path){return _c('sui-step',{key:path,attrs:{\"active\":\"\",\"icon\":_vm.getPathIcon(path),\"description\":_vm.getPathDescription(\n                  path,\n                  Math.round(_vm.currentDistanceMap.get(path))\n                ),\"title\":path}})}),1)],1)],1)],1):_vm._e(),_c('div',{staticClass:\"top-left-control-bar\"},[_c('sui-search',{attrs:{\"source\":_vm.source},on:{\"select\":_vm.handleSearch},scopedSlots:_vm._u([{key:\"input\",fn:function(ref){\n                var props = ref.props;\n                var handlers = ref.handlers;\nreturn [_c('sui-input',_vm._g(_vm._b({staticClass:\"search-input\",attrs:{\"placeholder\":\"搜索您要前往的地点\",\"icon-position\":\"left\",\"icon\":\"search\"}},'sui-input',props,false),handlers))]}}])}),(_vm.currentPosition !== null)?_c('sui-card',{staticClass:\"current-position\"},[_c('sui-card-content',[_vm._v(\"当前位置: \"+_vm._s(_vm.markers[_vm.currentPosition][\"label\"]))])],1):_vm._e(),(_vm.currentBest !== null)?_c('sui-card',{staticClass:\"current-best\"},[_c('sui-card-content',[_vm._v(\" 当前最优目的地: \"+_vm._s(_vm.currentBest.label)+\" \"),_c('sui-card-content',{attrs:{\"extra\":\"\"}},[_c('p',[_c('sui-icon',{attrs:{\"name\":\"paper plane\"}}),_vm._v(\"预计步行时间: \"+_vm._s(_vm.currentBest.distance)+\" 分钟 \")],1),_c('p',[_c('sui-icon',{attrs:{\"name\":\"clock\"}}),_vm._v(\"预计等待时间: \"+_vm._s(_vm.currentBest.time)+\" 分钟 \")],1)])],1)],1):_vm._e(),(_vm.currentLabel !== null)?_c('sui-card',{staticClass:\"detail\"},[_c('sui-image',{attrs:{\"src\":_vm.currentLabel.img}}),_c('sui-card-content',[_c('sui-card-header',[_vm._v(_vm._s(_vm.currentLabel.label))]),_c('sui-card-meta',{staticClass:\"vote\"},[_vm._v(\" 观景指数: \"),_c('sui-rating',{attrs:{\"rating\":_vm.currentLabel.scenery,\"max-rating\":5,\"disabled\":\"\"}}),_vm._v(\" 欢乐指数: \"),_c('sui-rating',{attrs:{\"rating\":_vm.currentLabel.fun,\"max-rating\":5,\"disabled\":\"\"}})],1),_c('sui-card-description',[_vm._v(_vm._s(_vm.currentLabel.description))])],1),_c('sui-card-content',{attrs:{\"extra\":\"\"}},[_c('div',{staticClass:\"wait-info\"},[_c('div',[_c('sui-icon',{attrs:{\"name\":\"user\"}}),_c('span',[_vm._v(\"当前排队人数: \"+_vm._s(_vm.waitNum(_vm.currentLabel.label))+\"人\")])],1),_c('div',[_c('sui-icon',{attrs:{\"name\":\"clock\"}}),_vm._v(\" 预计等待时间: \"+_vm._s(_vm.waitTime(_vm.currentLabel.label))+\"分钟 \")],1)])])],1):_vm._e()],1)]),_c('v-stage',{ref:\"stage\",staticClass:\"stage-container\",attrs:{\"config\":_vm.stageConfig},on:{\"wheel\":_vm.onWheelScroll,\"click\":_vm.onStageClick}},[_c('v-layer',[_c('v-rect',{attrs:{\"config\":{\n          x: 0,\n          y: 0,\n          width: _vm.global.width,\n          height: _vm.global.height,\n          fill: '#BAD588',\n        }}})],1),_c('v-layer',[_c('v-image',{ref:\"mapObj\",attrs:{\"config\":_vm.mapConfig},on:{\"dragend\":_vm.handleMapDrag}})],1),_c('v-layer',[_vm._l((_vm.markers),function(item){return _c('v-image',{key:(\"marker-\" + (item.label)),attrs:{\"config\":item}})}),_vm._l((_vm.markers),function(item){return _c('v-text',{key:(\"text-\" + (item.label)),attrs:{\"config\":{\n          x: item.x,\n          y: item.y,\n          text: (\"\" + (item.label)),\n          fontSize: 13,\n          fontFamily: 'Ubuntu Mono',\n          fill: 'rgba(0,0,0,0)',\n        }}})})],2),_c('v-layer',[_vm._l((_vm.paths),function(item){return _c('v-line',{key:(\"path-\" + (item.label)),attrs:{\"config\":item}})}),_vm._l((_vm.paths),function(item){return _c('v-text',{key:(\"path-distance-\" + (item.label)),attrs:{\"config\":{\n          x: item.mx,\n          y: item.my,\n          text: (\"\" + (item.distance)),\n          fontSize: 13,\n          fontFamily: 'Ubuntu Mono',\n        }}})})],2),_c('v-layer',_vm._l((_vm.labels),function(item){return _c('v-rect',{key:item.label,attrs:{\"config\":item},on:{\"click\":function($event){return _vm.handleLabelClick(item)}}})}),1),_c('v-layer',[_c('v-image',{ref:\"positionObj\",attrs:{\"config\":_vm.positionConfig},on:{\"dragend\":_vm.onPositionDragEnd}})],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nexport default function _createForOfIteratorHelper(o, allowArrayLike) {\n  var it;\n\n  if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) {\n    if (Array.isArray(o) || (it = unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n\n      var F = function F() {};\n\n      return {\n        s: F,\n        n: function n() {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function e(_e) {\n          throw _e;\n        },\n        f: F\n      };\n    }\n\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n\n  var normalCompletion = true,\n      didErr = false,\n      err;\n  return {\n    s: function s() {\n      it = o[Symbol.iterator]();\n    },\n    n: function n() {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function e(_e2) {\n      didErr = true;\n      err = _e2;\n    },\n    f: function f() {\n      try {\n        if (!normalCompletion && it[\"return\"] != null) it[\"return\"]();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}","<template>\r\n  <div class=\"root-container\">\r\n    <div class=\"control-layer\">\r\n      <div class=\"top-right-control-bar\" v-if=\"currentPath !== null\">\r\n        <sui-card>\r\n          <sui-card-header>路线规划</sui-card-header>\r\n          <sui-card-content>\r\n            <sui-step-group vertical fluid>\r\n              <sui-step\r\n                v-for=\"path in currentPath\"\r\n                :key=\"path\"\r\n                active\r\n                :icon=\"getPathIcon(path)\"\r\n                :description=\"\r\n                  getPathDescription(\r\n                    path,\r\n                    Math.round(currentDistanceMap.get(path))\r\n                  )\r\n                \"\r\n                :title=\"path\"\r\n              ></sui-step>\r\n            </sui-step-group>\r\n          </sui-card-content>\r\n        </sui-card>\r\n      </div>\r\n      <div class=\"top-left-control-bar\">\r\n        <sui-search :source=\"source\" @select=\"handleSearch\">\r\n          <template v-slot:input=\"{ props, handlers }\">\r\n            <sui-input\r\n              v-bind=\"props\"\r\n              v-on=\"handlers\"\r\n              placeholder=\"搜索您要前往的地点\"\r\n              icon-position=\"left\"\r\n              icon=\"search\"\r\n              class=\"search-input\"\r\n            />\r\n          </template>\r\n        </sui-search>\r\n\r\n        <sui-card v-if=\"currentPosition !== null\" class=\"current-position\"\r\n          ><sui-card-content\r\n            >当前位置: {{ markers[currentPosition][\"label\"] }}</sui-card-content\r\n          ></sui-card\r\n        >\r\n        <sui-card v-if=\"currentBest !== null\" class=\"current-best\">\r\n          <sui-card-content>\r\n            当前最优目的地: {{ currentBest.label }}\r\n            <sui-card-content extra>\r\n              <p>\r\n                <sui-icon name=\"paper plane\" />预计步行时间:\r\n                {{ currentBest.distance }} 分钟\r\n              </p>\r\n              <p>\r\n                <sui-icon name=\"clock\" />预计等待时间:\r\n                {{ currentBest.time }} 分钟\r\n              </p>\r\n            </sui-card-content>\r\n          </sui-card-content>\r\n        </sui-card>\r\n        <sui-card class=\"detail\" v-if=\"currentLabel !== null\">\r\n          <sui-image :src=\"currentLabel.img\" />\r\n          <sui-card-content>\r\n            <sui-card-header>{{ currentLabel.label }}</sui-card-header>\r\n            <sui-card-meta class=\"vote\">\r\n              观景指数:\r\n              <sui-rating\r\n                :rating=\"currentLabel.scenery\"\r\n                :max-rating=\"5\"\r\n                disabled\r\n              />\r\n              欢乐指数:\r\n              <sui-rating :rating=\"currentLabel.fun\" :max-rating=\"5\" disabled />\r\n            </sui-card-meta>\r\n            <sui-card-description>{{\r\n              currentLabel.description\r\n            }}</sui-card-description>\r\n          </sui-card-content>\r\n          <sui-card-content extra>\r\n            <div class=\"wait-info\">\r\n              <div>\r\n                <sui-icon name=\"user\" />\r\n                <span>当前排队人数: {{ waitNum(currentLabel.label) }}人</span>\r\n              </div>\r\n              <div>\r\n                <sui-icon name=\"clock\" />\r\n                预计等待时间: {{ waitTime(currentLabel.label) }}分钟\r\n              </div>\r\n            </div>\r\n          </sui-card-content>\r\n        </sui-card>\r\n      </div>\r\n      <!--      <div class=\"bottom-right-control-bar\">-->\r\n      <!--        <sui-button icon=\"zoom in\" @click=\"zoomIn\" />-->\r\n      <!--        <sui-button icon=\"zoom out\" @click=\"zoomOut\" />-->\r\n      <!--        <sui-button icon=\"sync alternate\" @click=\"resetScale\"></sui-button>-->\r\n      <!--      </div>-->\r\n    </div>\r\n    <v-stage\r\n      :config=\"stageConfig\"\r\n      ref=\"stage\"\r\n      @wheel=\"onWheelScroll\"\r\n      @click=\"onStageClick\"\r\n      class=\"stage-container\"\r\n    >\r\n      <v-layer>\r\n        <v-rect\r\n          :config=\"{\r\n            x: 0,\r\n            y: 0,\r\n            width: global.width,\r\n            height: global.height,\r\n            fill: '#BAD588',\r\n          }\"\r\n        ></v-rect>\r\n      </v-layer>\r\n      <v-layer>\r\n        <v-image :config=\"mapConfig\" ref=\"mapObj\" @dragend=\"handleMapDrag\">\r\n        </v-image>\r\n      </v-layer>\r\n      <v-layer>\r\n        <v-image\r\n          v-for=\"item in markers\"\r\n          :config=\"item\"\r\n          :key=\"`marker-${item.label}`\"\r\n        ></v-image>\r\n        <v-text\r\n          v-for=\"item in markers\"\r\n          :config=\"{\r\n            x: item.x,\r\n            y: item.y,\r\n            text: `${item.label}`,\r\n            fontSize: 13,\r\n            fontFamily: 'Ubuntu Mono',\r\n            fill: 'rgba(0,0,0,0)',\r\n          }\"\r\n          :key=\"`text-${item.label}`\"\r\n        >\r\n        </v-text>\r\n      </v-layer>\r\n      <v-layer>\r\n        <v-line\r\n          v-for=\"item in paths\"\r\n          :config=\"item\"\r\n          :key=\"`path-${item.label}`\"\r\n        ></v-line>\r\n        <v-text\r\n          v-for=\"item in paths\"\r\n          :config=\"{\r\n            x: item.mx,\r\n            y: item.my,\r\n            text: `${item.distance}`,\r\n            fontSize: 13,\r\n            fontFamily: 'Ubuntu Mono',\r\n          }\"\r\n          :key=\"`path-distance-${item.label}`\"\r\n        >\r\n        </v-text>\r\n      </v-layer>\r\n      <v-layer>\r\n        <v-rect\r\n          v-for=\"item in labels\"\r\n          :key=\"item.label\"\r\n          :config=\"item\"\r\n          @click=\"handleLabelClick(item)\"\r\n        ></v-rect>\r\n      </v-layer>\r\n      <v-layer>\r\n        <!--        <v-rect :config=\"rectConfig\" ref=\"rect\" @dragend=\"handleDragEnd\">-->\r\n        <!--        </v-rect>-->\r\n        <!--        <v-transformer ref=\"transformer\" @transformend=\"handleTransformEnd\" />-->\r\n        <v-image\r\n          :config=\"positionConfig\"\r\n          @dragend=\"onPositionDragEnd\"\r\n          ref=\"positionObj\"\r\n        ></v-image>\r\n      </v-layer>\r\n    </v-stage>\r\n  </div>\r\n</template>\r\n<script>\r\n// import * as Konva from \"konva\";\r\nimport markers from \"@/data/marker.json\";\r\nimport labels from \"@/data/labels.json\";\r\nimport paths from \"@/data/path.json\";\r\nimport { getCurrentWaitNum, getCurrentWaitTime } from \"@/util/data\";\r\nimport PriorityQueue from \"priorityqueuejs\";\r\n\r\nexport default {\r\n  name: \"Map\",\r\n  data() {\r\n    return {\r\n      global: {\r\n        width: 1920,\r\n        height: 960,\r\n      },\r\n\r\n      stageConfig: {\r\n        width: 1920,\r\n        height: 960,\r\n      },\r\n\r\n      mapConfig: {\r\n        image: null,\r\n        x: 0,\r\n        y: 0,\r\n        width: 0,\r\n        height: 0,\r\n        draggable: true,\r\n      },\r\n\r\n      mapImageObj: null,\r\n      markerImageObj: null,\r\n\r\n      scale: {\r\n        factor: 1.2,\r\n        minimum: 0.5,\r\n        maximum: 2.5,\r\n      },\r\n\r\n      markers: [],\r\n      labels: [],\r\n      paths: [],\r\n      edges: new Map(),\r\n      markerConfig: {\r\n        size: 32,\r\n        offset: 16,\r\n      },\r\n\r\n      searchInput: \"\",\r\n      // rectConfig: {\r\n      //   x: 1920 / 2,\r\n      //   y: 960 / 2,\r\n      //   draggable: true,\r\n      //   width: 20,\r\n      //   height: 20,\r\n      //   fill: \"rgba(0,255,0,0.8)\",\r\n      // },\r\n\r\n      currentBest: null,\r\n      currentLabel: null,\r\n      currentPosition: null,\r\n      currentDistance: null,\r\n      currentDistanceMap: null,\r\n      currentPath: null,\r\n      targetLabel: null,\r\n      positionConfig: {\r\n        image: null,\r\n        width: 36,\r\n        height: 36,\r\n        offsetX: 18,\r\n        offsetY: 18,\r\n        draggable: true,\r\n      },\r\n      source: this.generateSource(),\r\n    };\r\n  },\r\n  mounted() {\r\n    this.$nextTick(() => {\r\n      this.loadAssets();\r\n\r\n      setTimeout(() => {\r\n        this.setup();\r\n      }, 500);\r\n    });\r\n  },\r\n  methods: {\r\n    setup() {\r\n      this.loadLabels();\r\n      this.loadMarkers();\r\n      this.loadPaths();\r\n\r\n      if (this.currentPosition != null) {\r\n        const obj = this.$refs.positionObj.getNode();\r\n        const marker = this.markers[this.currentPosition];\r\n\r\n        obj.x(marker.x);\r\n        obj.y(marker.y);\r\n      }\r\n\r\n      this.currentPosition = 0;\r\n      this.findBest();\r\n\r\n      this.$refs.stage.getStage().batchDraw();\r\n    },\r\n    calculateDistance(x1, y1, x2, y2) {\r\n      return Math.sqrt((x1 - x2) * (x1 - x2) + (y1 - y2) * (y1 - y2));\r\n    },\r\n    loadPaths() {\r\n      this.edges = {};\r\n      this.paths = [];\r\n\r\n      for (const path of paths) {\r\n        const u = path[\"from\"];\r\n        const v = path[\"to\"];\r\n\r\n        const um = this.findMarkerByLabel(u);\r\n        const vm = this.findMarkerByLabel(v);\r\n\r\n        const distance = this.calculateDistance(um.x, um.y, vm.x, vm.y);\r\n\r\n        if (u in this.edges) {\r\n          this.edges[u].push({\r\n            vertex: v,\r\n            distance: distance,\r\n          });\r\n        } else {\r\n          this.edges[u] = [\r\n            {\r\n              vertex: v,\r\n              distance: distance,\r\n            },\r\n          ];\r\n        }\r\n\r\n        if (v in this.edges) {\r\n          this.edges[v].push({\r\n            vertex: u,\r\n            distance: distance,\r\n          });\r\n        } else {\r\n          this.edges[v] = [\r\n            {\r\n              vertex: u,\r\n              distance: distance,\r\n            },\r\n          ];\r\n        }\r\n\r\n        const line = {\r\n          points: [um.x, um.y, vm.x, vm.y],\r\n          stroke: \"red\",\r\n          strokeWidth: 10,\r\n          lineCap: \"round\",\r\n          lineJoin: \"round\",\r\n          dash: [29, 20, 0.001, 20],\r\n          distance: distance.toFixed(1),\r\n          label: `${path.from}-${path.to}`,\r\n          mx: (um.x + vm.x) / 2,\r\n          my: (um.y + vm.y) / 2,\r\n          from: path[\"from\"],\r\n          to: path[\"to\"],\r\n        };\r\n\r\n        if (this.currentPath != null) {\r\n          if (\r\n            this.currentPath.indexOf(path[\"from\"]) !== -1 &&\r\n            this.currentPath.indexOf(path[\"to\"]) !== -1\r\n          ) {\r\n            this.paths.push(line);\r\n          }\r\n        }\r\n      }\r\n    },\r\n    findMarkerByLabel(label) {\r\n      for (const marker of this.markers) {\r\n        if (marker.label === label) {\r\n          return marker;\r\n        }\r\n      }\r\n\r\n      return null;\r\n    },\r\n    loadMarkers() {\r\n      this.markers = [];\r\n\r\n      for (const marker of markers) {\r\n        this.generateMarker(marker);\r\n      }\r\n\r\n      this.positionConfig.x = this.markers[0].x;\r\n      this.positionConfig.y = this.markers[0].y;\r\n    },\r\n    loadLabels() {\r\n      this.$set(this, \"labels\", []);\r\n\r\n      for (const label of labels) {\r\n        const coord = this.denormalizeCoord({\r\n          x: label.x,\r\n          y: label.y,\r\n        });\r\n\r\n        this.labels.push(\r\n          Object.assign({}, label, coord, {\r\n            fill: \"rgba(255,255,255,0.00)\",\r\n            draggable: false,\r\n          })\r\n        );\r\n      }\r\n\r\n      this.$refs.stage.getStage().batchDraw();\r\n    },\r\n    loadAssets() {\r\n      const map = this.$refs.mapObj.getNode();\r\n\r\n      this.mapImageObj = new Image();\r\n\r\n      this.mapImageObj.onload = () => {\r\n        this.mapConfig.image = this.mapImageObj;\r\n        this.mapConfig.x = this.global.width / 2;\r\n        this.mapConfig.y = this.global.height / 2;\r\n        this.mapConfig.width = this.mapImageObj.naturalWidth / 4;\r\n        this.mapConfig.height = this.mapImageObj.naturalHeight / 4;\r\n\r\n        map.offsetX(this.mapConfig.width / 2);\r\n        map.offsetY(this.mapConfig.height / 2);\r\n      };\r\n\r\n      this.mapImageObj.src = \"/assets/map2.webp\";\r\n\r\n      this.markerImageObj = new Image();\r\n      this.markerImageObj.src = \"/assets/marker.png\";\r\n\r\n      // const rect = this.$refs.rect.getNode();\r\n      //\r\n      // rect.offsetX(this.rectConfig.width / 2);\r\n      // rect.offsetY(this.rectConfig.height / 2);\r\n\r\n      // this.$refs.transformer.getNode().nodes([this.$refs.rect.getNode()]);\r\n\r\n      const positionImage = new Image();\r\n      positionImage.src = \"/assets/pos.png\";\r\n\r\n      positionImage.onload = () => {\r\n        this.positionConfig.image = positionImage;\r\n      };\r\n    },\r\n\r\n    relativePosition() {\r\n      const stage = this.$refs.stage.getStage();\r\n\r\n      const transform = stage.getAbsoluteTransform().copy();\r\n\r\n      transform.invert();\r\n\r\n      const pos = stage.getPointerPosition();\r\n\r\n      return transform.point(pos);\r\n    },\r\n\r\n    onWheelScroll(e) {\r\n      const stage = this.$refs.stage.getStage();\r\n\r\n      const oldScale = stage.scaleX();\r\n\r\n      const pointer = stage.getPointerPosition();\r\n\r\n      const mousePointTo = {\r\n        x: (pointer.x - stage.x()) / oldScale,\r\n        y: (pointer.y - stage.y()) / oldScale,\r\n      };\r\n\r\n      const newScale =\r\n        e.evt.deltaY < 0\r\n          ? oldScale * this.scale.factor\r\n          : oldScale / this.scale.factor;\r\n\r\n      if (newScale >= this.scale.maximum || newScale <= this.scale.minimum)\r\n        return;\r\n\r\n      stage.scale({ x: newScale, y: newScale });\r\n\r\n      const newPos = {\r\n        x: pointer.x - mousePointTo.x * newScale,\r\n        y: pointer.y - mousePointTo.y * newScale,\r\n      };\r\n\r\n      stage.position(newPos);\r\n      stage.batchDraw();\r\n    },\r\n\r\n    onStageClick(e) {\r\n      e.evt.preventDefault();\r\n\r\n      // if (e.evt.button === 0) {\r\n      //   const cursor = this.relativePosition();\r\n      //\r\n      //   this.markers.push({\r\n      //     x: cursor.x - 16,\r\n      //     y: cursor.y - 26,\r\n      //     width: 32,\r\n      //     height: 32,\r\n      //     image: this.markerImageObj,\r\n      //     uid: this.markers.length,\r\n      //   });\r\n      //\r\n      // }\r\n    },\r\n    // resetScale() {\r\n    //   const stage = this.$refs.stage.getStage();\r\n    //   const map = this.$refs.mapObj.getNode();\r\n    //\r\n    //   stage.scale({ x: 1, y: 1 });\r\n    //   map.scale({ x: 1, y: 1 });\r\n    //\r\n    //   stage.position({\r\n    //     x: 0,\r\n    //     y: 0,\r\n    //   });\r\n    //\r\n    //   stage.batchDraw();\r\n    // },\r\n    // zoomIn() {\r\n    //   const map = this.$refs.mapObj.getNode();\r\n    //   const oldScale = map.scaleX();\r\n    //\r\n    //   const newScale = oldScale * this.scale.factor;\r\n    //\r\n    //   if (newScale >= this.scale.maximum || newScale <= this.scale.minimum)\r\n    //     return;\r\n    //\r\n    //   const tween = new Konva.Tween({\r\n    //     node: map,\r\n    //     duration: 0.2,\r\n    //     scaleX: newScale,\r\n    //     scaleY: newScale,\r\n    //     easing: Konva.Easings.Linear,\r\n    //   });\r\n    //\r\n    //   tween.play();\r\n    // },\r\n    // zoomOut() {\r\n    //   const map = this.$refs.mapObj.getNode();\r\n    //   const oldScale = map.scaleX();\r\n    //\r\n    //   const newScale = oldScale / this.scale.factor;\r\n    //\r\n    //   if (newScale >= this.scale.maximum || newScale <= this.scale.minimum)\r\n    //     return;\r\n    //\r\n    //   const tween = new Konva.Tween({\r\n    //     node: map,\r\n    //     duration: 0.2,\r\n    //     scaleX: newScale,\r\n    //     scaleY: newScale,\r\n    //     easing: Konva.Easings.Linear,\r\n    //   });\r\n    //\r\n    //   tween.play();\r\n    // },\r\n\r\n    generateMarker(marker) {\r\n      const coord = this.denormalizeCoord({\r\n        x: marker.x,\r\n        y: marker.y,\r\n      });\r\n\r\n      this.markers.push({\r\n        x: coord.x,\r\n        y: coord.y,\r\n        width: this.markerConfig.size,\r\n        height: this.markerConfig.size,\r\n        label: marker.label,\r\n        // image: this.markerImageObj,\r\n        offsetX: this.markerConfig.size / 2,\r\n        offsetY: this.markerConfig.size / 2,\r\n        type: marker.type,\r\n      });\r\n    },\r\n    // handleDragEnd(e) {\r\n    //   const coord = this.normalizeCoord({\r\n    //     x: e.target.x(),\r\n    //     y: e.target.y(),\r\n    //   });\r\n    //\r\n    //   console.log(\r\n    //     JSON.stringify({\r\n    //       x: parseInt(coord.x.toFixed(0)),\r\n    //       y: parseInt(coord.y.toFixed(0)),\r\n    //     })\r\n    //   );\r\n    // },\r\n    // handleTransformEnd(e) {\r\n    //   const coord = this.normalizeCoord({\r\n    //     x: e.target.x(),\r\n    //     y: e.target.y(),\r\n    //   });\r\n    //\r\n    //   console.log(\r\n    //     JSON.stringify({\r\n    //       x: parseInt(coord.x.toFixed(0)),\r\n    //       y: parseInt(coord.y.toFixed(0)),\r\n    //       width: parseInt((e.target.width() * e.target.scaleX()).toFixed(0)),\r\n    //       height: parseInt((e.target.height() * e.target.scaleY()).toFixed(0)),\r\n    //     })\r\n    //   );\r\n    // },\r\n    handleMapDrag() {\r\n      const stage = this.$refs.stage.getStage();\r\n\r\n      this.setup();\r\n\r\n      stage.batchDraw();\r\n    },\r\n    normalizeCoord(coord) {\r\n      const map = this.$refs.mapObj.getNode();\r\n\r\n      return {\r\n        x: (coord.x - map.x()) / map.scaleX(),\r\n        y: (coord.y - map.y()) / map.scaleY(),\r\n      };\r\n    },\r\n    denormalizeCoord(coord) {\r\n      const map = this.$refs.mapObj.getNode();\r\n\r\n      return {\r\n        x: (coord.x + map.x()) * map.scaleX(),\r\n        y: (coord.y + map.y()) * map.scaleY(),\r\n      };\r\n    },\r\n    handleLabelClick(label) {\r\n      if (this.currentLabel === label) {\r\n        this.currentLabel = null;\r\n      } else {\r\n        this.currentLabel = label;\r\n        this.currentLabel.img = `/assets/${label.label}.jpg`;\r\n\r\n        const r = this.findShortestPath();\r\n        this.currentDistance = r.distance;\r\n        this.currentDistanceMap = r.distanceMap;\r\n        this.currentPath = r.path;\r\n\r\n        this.loadPaths();\r\n      }\r\n    },\r\n    waitNum(label) {\r\n      return getCurrentWaitNum(label);\r\n    },\r\n    waitTime(label) {\r\n      return getCurrentWaitTime(label);\r\n    },\r\n    onPositionDragEnd() {\r\n      const obj = this.$refs.positionObj.getNode();\r\n\r\n      const x = obj.x();\r\n      const y = obj.y();\r\n\r\n      let mm = null;\r\n      let md = 0x3f3f3f3f;\r\n\r\n      for (let i = 0; i < this.markers.length; i++) {\r\n        const marker = this.markers[i];\r\n\r\n        const di = this.calculateDistance(x, y, marker.x, marker.y);\r\n\r\n        if (md > di) {\r\n          md = di;\r\n          mm = i;\r\n        }\r\n      }\r\n\r\n      const marker = this.markers[mm];\r\n\r\n      obj.x(marker.x);\r\n      obj.y(marker.y);\r\n\r\n      this.currentPosition = mm;\r\n      this.findBest();\r\n    },\r\n    findBest() {\r\n      const { distanceMap } = this.findShortestPath();\r\n\r\n      let med = 0x3f3f3f3f;\r\n      let mei = null;\r\n\r\n      for (const [key, value] of distanceMap) {\r\n        if (\r\n          this.findMarkerByLabel(key).type === \"游乐设施\" &&\r\n          key !== this.markers[this.currentPosition].label\r\n        ) {\r\n          const estimate =\r\n            this.estimateTime(value) * 0.7 + this.waitTime(key) * 0.3;\r\n\r\n          if (estimate < med) {\r\n            med = estimate;\r\n            mei = key;\r\n          }\r\n        }\r\n      }\r\n\r\n      this.currentBest = {\r\n        label: mei,\r\n        distance: this.estimateTime(distanceMap.get(mei)),\r\n        time: this.waitTime(mei),\r\n      };\r\n    },\r\n    findShortestPath() {\r\n      const source = this.markers[this.currentPosition].label;\r\n\r\n      let target;\r\n\r\n      if (this.currentLabel === null) {\r\n        target = \"重庆之眼\";\r\n      } else {\r\n        target = this.currentLabel.label;\r\n      }\r\n\r\n      const d = new Map();\r\n      const p = new Map();\r\n      const vis = new Map();\r\n\r\n      const getOrPut = (m) => (key, value) => {\r\n        if (!m.has(key)) m.set(key, value);\r\n\r\n        return m.get(key);\r\n      };\r\n\r\n      d.set(source, 0);\r\n\r\n      const heap = new PriorityQueue((a, b) => {\r\n        return a.distance - b.distance;\r\n      });\r\n\r\n      heap.enq({\r\n        label: source,\r\n        distance: 0,\r\n      });\r\n\r\n      while (!heap.isEmpty()) {\r\n        const t = heap.deq();\r\n\r\n        if (getOrPut(vis)(t.label, false) === true) continue;\r\n\r\n        vis.set(t.label, true);\r\n\r\n        for (const node of this.edges[t.label]) {\r\n          const vertex = node.vertex;\r\n          const distance = node.distance;\r\n\r\n          if (\r\n            getOrPut(d)(vertex, 0x3f3f3f) >\r\n            getOrPut(d)(t.label, 0x3f3f3f) + distance\r\n          ) {\r\n            d.set(vertex, d.get(t.label) + distance);\r\n            p.set(vertex, t.label);\r\n\r\n            heap.enq({\r\n              label: vertex,\r\n              distance: d[vertex],\r\n            });\r\n          }\r\n        }\r\n      }\r\n\r\n      const reverse = (arr) => {\r\n        let r = [];\r\n\r\n        for (let i = arr.length - 1; i >= 0; i--) r.push(arr[i]);\r\n\r\n        return r;\r\n      };\r\n\r\n      let t = p.get(target);\r\n      let rp = [target];\r\n\r\n      while (p.has(t)) {\r\n        rp.push(t);\r\n        t = p.get(t);\r\n      }\r\n\r\n      rp.push(source);\r\n\r\n      return {\r\n        distance: d.get(target),\r\n        distanceMap: d,\r\n        path: reverse(rp),\r\n      };\r\n    },\r\n    getPathDescription(label, distance) {\r\n      if (distance === 0) {\r\n        return \"当前位置\";\r\n      } else {\r\n        return `预计步行时间: ${this.estimateTime(distance)} 分钟`;\r\n      }\r\n    },\r\n    getPathIcon(label) {\r\n      const marker = this.findMarkerByLabel(label);\r\n\r\n      if (marker.type === \"道路标记\") {\r\n        return \"road\";\r\n      } else {\r\n        return \"gamepad\";\r\n      }\r\n    },\r\n    estimateTime(distance) {\r\n      return Math.round(distance / 55.4);\r\n    },\r\n    generateSource() {\r\n      return labels.map((v) => {\r\n        return {\r\n          title: v[\"label\"],\r\n        };\r\n      });\r\n    },\r\n    handleSearch(value) {\r\n      for (const label of labels) {\r\n        if (label[\"label\"] === value[\"title\"]) {\r\n          this.handleLabelClick(label);\r\n          return;\r\n        }\r\n      }\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\">\r\nbody {\r\n  overflow-y: hidden;\r\n}\r\n\r\n.root-container {\r\n  position: relative;\r\n  background: #bad588;\r\n\r\n  .control-layer {\r\n    position: absolute;\r\n    z-index: 100;\r\n\r\n    .top-left-control-bar {\r\n      position: fixed;\r\n      left: 8px;\r\n      top: 8px;\r\n      display: flex;\r\n      flex-direction: column;\r\n      width: 350px;\r\n\r\n      .search-input {\r\n        width: 100%;\r\n\r\n        .prompt {\r\n          border-radius: 3px !important;\r\n        }\r\n      }\r\n\r\n      .detail {\r\n        width: 350px;\r\n\r\n        .vote {\r\n          padding: 8px 0;\r\n          display: flex;\r\n          align-items: center;\r\n        }\r\n\r\n        .description {\r\n          box-sizing: border-box;\r\n          padding: 8px 12px;\r\n          text-align: left;\r\n          height: 130px;\r\n          overflow-y: auto;\r\n        }\r\n\r\n        .wait-info {\r\n          display: flex;\r\n          flex-direction: column;\r\n          justify-content: center;\r\n\r\n          > div {\r\n            padding: 6px 4px;\r\n          }\r\n        }\r\n      }\r\n\r\n      .current-position {\r\n        width: 350px;\r\n\r\n        font-weight: bold;\r\n        letter-spacing: 3px;\r\n        margin: 0.8em 0 0 0;\r\n      }\r\n\r\n      .current-best {\r\n        width: 350px;\r\n        font-weight: bold;\r\n        letter-spacing: 3px;\r\n\r\n        .content {\r\n          padding: 12px 0;\r\n        }\r\n\r\n        margin: 0.8em 0 0 0;\r\n      }\r\n    }\r\n\r\n    .bottom-right-control-bar {\r\n      position: fixed;\r\n      bottom: 8px;\r\n      right: 8px;\r\n      display: flex;\r\n      align-items: baseline;\r\n\r\n      button {\r\n        margin-right: 8px;\r\n      }\r\n    }\r\n\r\n    .top-right-control-bar {\r\n      position: fixed;\r\n      right: 8px;\r\n      top: 8px;\r\n\r\n      .header {\r\n        font-weight: bold;\r\n        font-size: 22px;\r\n        padding: 16px 0;\r\n      }\r\n\r\n      .card > .content {\r\n        overflow-y: auto;\r\n        overflow-x: hidden;\r\n        height: 600px;\r\n        box-sizing: border-box;\r\n        padding: 8px 0;\r\n        background: transparent;\r\n      }\r\n\r\n      .step > .content {\r\n        flex-grow: 1 !important;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Map.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Map.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Map.vue?vue&type=template&id=38f84cf2&\"\nimport script from \"./Map.vue?vue&type=script&lang=js&\"\nexport * from \"./Map.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Map.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","'use strict';\nvar collection = require('../internals/collection');\nvar collectionStrong = require('../internals/collection-strong');\n\n// `Map` constructor\n// https://tc39.es/ecma262/#sec-map-objects\nmodule.exports = collection('Map', function (init) {\n  return function Map() { return init(this, arguments.length ? arguments[0] : undefined); };\n}, collectionStrong);\n","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Map.vue?vue&type=style&index=0&lang=scss&\""],"sourceRoot":""}